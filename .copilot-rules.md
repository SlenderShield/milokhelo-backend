# 🧠 Copilot Codebase Organization Rules

> **CRITICAL:** These rules MUST be followed for all code generation, file creation, and refactoring in this project.

---

## 📁 **Directory Structure Standards**

### **Root Directory**
- **ONLY** essential project files belong in the root:
  - `README.md` - Main project documentation
  - `LICENSE` - Project license
  - `package.json`, `package-lock.json` - Dependencies
  - Configuration files: `.env.example`, `.gitignore`, `.prettierrc.json`, `eslint.config.js`, `.mocharc.cjs`
  - Docker files: `Dockerfile.*`, `docker-compose.*.yml`
- **NO** other documentation, specifications, or supporting materials in root

### **Documentation Organization**
- `docs/` - **Permanent documentation**
  - Architecture documentation
  - Codebase analysis
  - Improvement logs
  - Quickstart guides
  - API documentation
  - Design decisions
- `temp_docs/` - **Temporary/auto-generated documentation**
  - Scratch work
  - Intermediate outputs
  - Planning documents (short-term)
  - **Must be cleaned up after use**
  - Should be in `.gitignore`

### **Source Code Structure (`src/`)**
```
src/
├── app.js                      # Application setup
├── server.js                   # Server entry point
├── bootstrap.js                # Initialization logic
├── infrastructure/             # Cross-cutting concerns
│   ├── config/                 # Configuration management
│   ├── database/               # Database connection & health
│   ├── di/                     # Dependency injection
│   ├── eventBus/               # Event bus implementations
│   ├── health/                 # Health check routes
│   ├── logger/                 # Logging utilities
│   ├── middlewares/            # Express middlewares
│   └── utils/                  # Infrastructure utilities
├── modules/                    # Feature modules (Clean Architecture)
│   └── [module-name]/
│       ├── index.js            # Module exports
│       ├── domain/             # Business entities & interfaces
│       │   ├── [Entity].js
│       │   └── I[Repository].js
│       ├── application/        # Business logic & services
│       │   └── [Service].js
│       └── infrastructure/     # External concerns
│           ├── [Controller].js # API request handlers
│           ├── [Model].js      # Database models
│           ├── [Repository].js # Data access implementation
│           └── [Routes].js     # Route definitions
└── shared/                     # Shared utilities across modules
    ├── constants/
    └── utils/
```

---

## 🚫 **NEVER DO THIS**

1. ❌ **DO NOT duplicate existing code, modules, or features**
2. ❌ **DO NOT create new utilities without checking if they already exist**
3. ❌ **DO NOT place documentation in the root directory**
4. ❌ **DO NOT leave temporary files in production folders**
5. ❌ **DO NOT violate the module structure (domain/application/infrastructure)**
6. ❌ **DO NOT create flat file structures - always organize by feature/domain**
7. ❌ **DO NOT mix concerns (e.g., business logic in controllers)**

---

## ✅ **ALWAYS DO THIS**

1. ✅ **Check for existing implementations before creating new code**
2. ✅ **Follow Clean Architecture principles** (domain → application → infrastructure)
3. ✅ **Use consistent naming conventions:**
   - Folders/files: `kebab-case`
   - Classes: `PascalCase`
   - Functions/variables: `camelCase`
   - Constants: `UPPER_SNAKE_CASE`
4. ✅ **Organize by feature/domain, not by technical role**
5. ✅ **Keep controllers thin** - delegate to services
6. ✅ **Keep services focused** - single responsibility
7. ✅ **Use repositories for all data access**
8. ✅ **Extract shared utilities to `shared/utils/`**
9. ✅ **Document architectural decisions in `docs/`**
10. ✅ **Clean up `temp_docs/` after temporary work is complete**

---

## 🧱 **Module Creation Checklist**

Before creating a new module, verify:

- [ ] No existing module handles this domain
- [ ] No existing utility provides this functionality
- [ ] The feature aligns with project architecture
- [ ] Module follows Clean Architecture structure:
  - `domain/` - Entities, Value Objects, Repository Interfaces
  - `application/` - Use Cases, Services, Business Logic
  - `infrastructure/` - Controllers, Routes, Repository Implementations, Models

Module Template:
```
modules/[module-name]/
├── index.js                    # Public API exports
├── domain/
│   ├── [Entity].js             # Business entity
│   ├── I[Repository].js        # Repository interface
│   └── index.js
├── application/
│   ├── [Service].js            # Business logic
│   └── index.js
└── infrastructure/
    ├── [Controller].js         # HTTP handlers
    ├── [Model].js              # Database schema
    ├── [Repository].js         # Repository implementation
    ├── [Routes].js             # Route definitions
    └── index.js
```

---

## 🎯 **Code Quality Standards**

### **SOLID Principles**
- **S**ingle Responsibility
- **O**pen/Closed
- **L**iskov Substitution
- **I**nterface Segregation
- **D**ependency Inversion

### **DRY (Don't Repeat Yourself)**
- Extract common logic to utilities
- Reuse existing functions
- Create abstractions for repeated patterns

### **KISS (Keep It Simple, Stupid)**
- Prefer simple solutions
- Avoid over-engineering
- Write readable code

---

## 📝 **File Naming Conventions**

| Type | Convention | Example |
|------|------------|---------|
| Folders | kebab-case | `event-bus/`, `user-management/` |
| Files | kebab-case OR PascalCase (for classes) | `user-service.js`, `UserEntity.js` |
| Classes | PascalCase | `UserService`, `OrderEntity` |
| Interfaces | PascalCase with `I` prefix | `IUserRepository`, `IEventBus` |
| Functions | camelCase | `createUser()`, `validateEmail()` |
| Variables | camelCase | `userData`, `isActive` |
| Constants | UPPER_SNAKE_CASE | `MAX_RETRIES`, `API_VERSION` |

---

## 🔄 **Before Every Code Change**

1. **Search for existing implementations**
   - Check `src/shared/utils/`
   - Check similar modules
   - Check infrastructure utilities

2. **Verify module structure**
   - Does this belong in an existing module?
   - Should this be in `shared/`?
   - Is the Clean Architecture structure followed?

3. **Check for duplication**
   - Similar entities?
   - Similar services?
   - Similar utilities?

4. **Maintain consistency**
   - Follow existing patterns
   - Use established conventions
   - Respect architectural boundaries

---

## 🧪 **Testing Structure**

```
test/
├── helpers/          # Test setup utilities
├── unit/            # Unit tests (isolated)
├── integration/     # Integration tests (with dependencies)
└── e2e/             # End-to-end tests (full flow)
```

- Test files mirror source structure
- Name: `[feature].test.js`
- One test file per module/utility

---

## 📦 **Dependency Injection**

- All dependencies injected via DI container (`src/infrastructure/di/`)
- Controllers receive services via DI
- Services receive repositories via DI
- No direct instantiation in business logic

---

## 🚀 **Integration with Existing Code**

When adding features:

1. **Extend** existing modules when possible
2. **Refactor** if adding to existing module improves organization
3. **Create new module** only if domain is truly distinct
4. **Update documentation** in `docs/` after major changes
5. **Clean up** any temporary files from `temp_docs/`

---

## 🔒 **Persistent Rule**

> This file represents the **source of truth** for codebase organization.
> All Copilot-generated code MUST comply with these rules.
> These rules supersede general conventions when there's a conflict.
> Review this file before making architectural decisions.

---

**Last Updated:** 29 October 2025
