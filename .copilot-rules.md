# ðŸ§  Copilot Codebase Organization Rules

> **CRITICAL:** These rules MUST be followed for all code generation, file creation, and refactoring in this project.

---

## ðŸ“ **Directory Structure Standards**

### **Root Directory**
- **ONLY** essential project files belong in the root:
  - `README.md` - Main project documentation
  - `LICENSE` - Project license
  - `package.json`, `package-lock.json` - Dependencies
  - Configuration files: `.env.example`, `.gitignore`, `.prettierrc.json`, `eslint.config.js`, `.mocharc.cjs`
  - Docker files: `Dockerfile.*`, `docker-compose.*.yml`
- **NO** other documentation, specifications, or supporting materials in root

### **Documentation Organization**
- `docs/` - **Permanent documentation**
  - Architecture documentation
  - Codebase analysis
  - Improvement logs
  - Quickstart guides
  - API documentation
  - Design decisions
- `temp_docs/` - **Temporary/auto-generated documentation**
  - Scratch work
  - Intermediate outputs
  - Planning documents (short-term)
  - **Must be cleaned up after use**
  - Should be in `.gitignore`

### **Source Code Structure (`src/`)**
```
src/
â”œâ”€â”€ app.js                      # Application setup
â”œâ”€â”€ server.js                   # Server entry point
â”œâ”€â”€ bootstrap.js                # Initialization logic
â”œâ”€â”€ infrastructure/             # Cross-cutting concerns
â”‚   â”œâ”€â”€ config/                 # Configuration management
â”‚   â”œâ”€â”€ database/               # Database connection & health
â”‚   â”œâ”€â”€ di/                     # Dependency injection
â”‚   â”œâ”€â”€ eventBus/               # Event bus implementations
â”‚   â”œâ”€â”€ health/                 # Health check routes
â”‚   â”œâ”€â”€ logger/                 # Logging utilities
â”‚   â”œâ”€â”€ middlewares/            # Express middlewares
â”‚   â””â”€â”€ utils/                  # Infrastructure utilities
â”œâ”€â”€ modules/                    # Feature modules (Clean Architecture)
â”‚   â””â”€â”€ [module-name]/
â”‚       â”œâ”€â”€ index.js            # Module exports
â”‚       â”œâ”€â”€ domain/             # Business entities & interfaces
â”‚       â”‚   â”œâ”€â”€ [Entity].js
â”‚       â”‚   â””â”€â”€ I[Repository].js
â”‚       â”œâ”€â”€ application/        # Business logic & services
â”‚       â”‚   â””â”€â”€ [Service].js
â”‚       â””â”€â”€ infrastructure/     # External concerns
â”‚           â”œâ”€â”€ [Controller].js # API request handlers
â”‚           â”œâ”€â”€ [Model].js      # Database models
â”‚           â”œâ”€â”€ [Repository].js # Data access implementation
â”‚           â””â”€â”€ [Routes].js     # Route definitions
â””â”€â”€ shared/                     # Shared utilities across modules
    â”œâ”€â”€ constants/
    â””â”€â”€ utils/
```

---

## ðŸš« **NEVER DO THIS**

1. âŒ **DO NOT duplicate existing code, modules, or features**
2. âŒ **DO NOT create new utilities without checking if they already exist**
3. âŒ **DO NOT place documentation in the root directory**
4. âŒ **DO NOT leave temporary files in production folders**
5. âŒ **DO NOT violate the module structure (domain/application/infrastructure)**
6. âŒ **DO NOT create flat file structures - always organize by feature/domain**
7. âŒ **DO NOT mix concerns (e.g., business logic in controllers)**

---

## âœ… **ALWAYS DO THIS**

1. âœ… **Check for existing implementations before creating new code**
2. âœ… **Follow Clean Architecture principles** (domain â†’ application â†’ infrastructure)
3. âœ… **Use consistent naming conventions:**
   - Folders/files: `kebab-case`
   - Classes: `PascalCase`
   - Functions/variables: `camelCase`
   - Constants: `UPPER_SNAKE_CASE`
4. âœ… **Organize by feature/domain, not by technical role**
5. âœ… **Keep controllers thin** - delegate to services
6. âœ… **Keep services focused** - single responsibility
7. âœ… **Use repositories for all data access**
8. âœ… **Extract shared utilities to `shared/utils/`**
9. âœ… **Document architectural decisions in `docs/`**
10. âœ… **Clean up `temp_docs/` after temporary work is complete**

---

## ðŸ§± **Module Creation Checklist**

Before creating a new module, verify:

- [ ] No existing module handles this domain
- [ ] No existing utility provides this functionality
- [ ] The feature aligns with project architecture
- [ ] Module follows Clean Architecture structure:
  - `domain/` - Entities, Value Objects, Repository Interfaces
  - `application/` - Use Cases, Services, Business Logic
  - `infrastructure/` - Controllers, Routes, Repository Implementations, Models

Module Template:
```
modules/[module-name]/
â”œâ”€â”€ index.js                    # Public API exports
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ [Entity].js             # Business entity
â”‚   â”œâ”€â”€ I[Repository].js        # Repository interface
â”‚   â””â”€â”€ index.js
â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ [Service].js            # Business logic
â”‚   â””â”€â”€ index.js
â””â”€â”€ infrastructure/
    â”œâ”€â”€ [Controller].js         # HTTP handlers
    â”œâ”€â”€ [Model].js              # Database schema
    â”œâ”€â”€ [Repository].js         # Repository implementation
    â”œâ”€â”€ [Routes].js             # Route definitions
    â””â”€â”€ index.js
```

---

## ðŸŽ¯ **Code Quality Standards**

### **SOLID Principles**
- **S**ingle Responsibility
- **O**pen/Closed
- **L**iskov Substitution
- **I**nterface Segregation
- **D**ependency Inversion

### **DRY (Don't Repeat Yourself)**
- Extract common logic to utilities
- Reuse existing functions
- Create abstractions for repeated patterns

### **KISS (Keep It Simple, Stupid)**
- Prefer simple solutions
- Avoid over-engineering
- Write readable code

---

## ðŸ“ **File Naming Conventions**

| Type | Convention | Example |
|------|------------|---------|
| Folders | kebab-case | `event-bus/`, `user-management/` |
| Files | kebab-case OR PascalCase (for classes) | `user-service.js`, `UserEntity.js` |
| Classes | PascalCase | `UserService`, `OrderEntity` |
| Interfaces | PascalCase with `I` prefix | `IUserRepository`, `IEventBus` |
| Functions | camelCase | `createUser()`, `validateEmail()` |
| Variables | camelCase | `userData`, `isActive` |
| Constants | UPPER_SNAKE_CASE | `MAX_RETRIES`, `API_VERSION` |

---

## ðŸ”„ **Before Every Code Change**

1. **Search for existing implementations**
   - Check `src/shared/utils/`
   - Check similar modules
   - Check infrastructure utilities

2. **Verify module structure**
   - Does this belong in an existing module?
   - Should this be in `shared/`?
   - Is the Clean Architecture structure followed?

3. **Check for duplication**
   - Similar entities?
   - Similar services?
   - Similar utilities?

4. **Maintain consistency**
   - Follow existing patterns
   - Use established conventions
   - Respect architectural boundaries

---

## ðŸ§ª **Testing Structure**

```
test/
â”œâ”€â”€ helpers/          # Test setup utilities
â”œâ”€â”€ unit/            # Unit tests (isolated)
â”œâ”€â”€ integration/     # Integration tests (with dependencies)
â””â”€â”€ e2e/             # End-to-end tests (full flow)
```

- Test files mirror source structure
- Name: `[feature].test.js`
- One test file per module/utility

---

## ðŸ“¦ **Dependency Injection**

- All dependencies injected via DI container (`src/infrastructure/di/`)
- Controllers receive services via DI
- Services receive repositories via DI
- No direct instantiation in business logic

---

## ðŸš€ **Integration with Existing Code**

When adding features:

1. **Extend** existing modules when possible
2. **Refactor** if adding to existing module improves organization
3. **Create new module** only if domain is truly distinct
4. **Update documentation** in `docs/` after major changes
5. **Clean up** any temporary files from `temp_docs/`

---

## ðŸ”’ **Persistent Rule**

> This file represents the **source of truth** for codebase organization.
> All Copilot-generated code MUST comply with these rules.
> These rules supersede general conventions when there's a conflict.
> Review this file before making architectural decisions.

---

**Last Updated:** 29 October 2025
